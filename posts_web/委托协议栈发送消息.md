---
title: 委托协议栈发送消息
description: 
date: 2022-4-25
tags:
  - DNS
---
### 委托协议栈发送消息
```
和查询DNS服务器一样
需要使用socket库中的程序组件（查询ip地址只需要调用一个程序组件就可以）
而这里需要调用多个程序组件
```

```
向操作系统内的协议栈发出委托时需要按照指定的顺序来调用socket库中的程序组件
```
### 使用socket库来手法数据的操作过程
```
第一步 收发数据的两台计算机中间建立通道
管道的数据出入口是关键
这些出入口即为套接字
```
### 具体的流程 * 套接字即为socket
```
- 首先 服务器一方先创建套接字
- 然后等待客户端向该套接字连接管道
- 当服务器进入等待状态的时候 客户端就可以连接管道了

-- 客户端也会先创建一个套接字
-- 然后该套接字延申出管道
-- 最后管道连接到服务器的套接字上
-- 当双方的套接字连接起来后
-- 通信准备完成
-- 将数据送入套接字
```
### 收发数据的阶段
```
1. 创建套接字
2. 将管道连接到服务器端的套接字上
3. 收发数据
4. 断开管道并删除套接字
```

```
在每个阶段 socket库中的程序组件都会被调用来执行相关数据收发操作

这四个操作都是由操作系统的协议栈来执行的

浏览器等应用程序并不会自己去做连接管道，放入数据
而是委托协议栈来代劳

这些委托操作都是通过调用socket库中的程序来执行
但这些数据通信用的程序组件其实仅仅充当了一个桥梁的角色
并不会执行任何实际性的操作
```

```
应用程序的委托被最终会被原原本本地传递给协议栈
```
### 创建套接字阶段
```
应用程序委托发送数据的时候会按照一定顺序调用socket组件
dns查询会调用gethostbyname的程序
```

### 客户端创建套接字
```
调用socket库中的socket组件 -> 创建套接字
->协议栈返回描述符->应用程序将描述符放在内存->描述符用于识别套接字
```
```
应用程序是通过“描述符”这一类似号码牌的东西来识别套接字的。
```
### 连接
```
需要 描述符 服务器ip地址 端口号
```